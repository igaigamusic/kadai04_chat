<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>LINEé¢¨ã‚¢ãƒ—ãƒªï¼ˆã¡ã„ã‹ã‚ï¼‰</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<!-- <body class="bg-green-100 w-[414px]"> -->

<body class="bg-green-100 w-[414px] h-screen flex flex-col items-center">
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div class="w-full max-w-md bg-white shadow-lg rounded-md p-4 flex flex-col space-y-4">
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="flex flex-col space-y-2">
            <label class="text-sm font-medium text-gray-700">åå‰:</label>
            <input type="text" id="uname" class="border rounded-lg p-2 focus:ring-2 focus:ring-green-400 outline-none">
        </div>
        <div class="flex flex-col space-y-2">
            <label class="text-sm font-medium text-gray-700">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label>
            <textarea id="text" cols="30" rows="4" placeholder="æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                class="border rounded-lg p-2 focus:ring-2 focus:ring-green-400 outline-none"></textarea>
        </div>
        <button id="send"
            class="cursor-pointer rounded-lg bg-green-500 px-3 py-2 text-white font-semibold text-lg transition duration-150 ease-in-out transform hover:bg-green-600 active:scale-95">
            é€ä¿¡
        </button>
        <!-- ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="output" class="overflow-auto h-[300px] space-y-2 p-2 bg-[url('https://chiikawapark.com/wp-content/uploads/2024/08/chiikawapocket2024082101.jpg.webp')] bg-cover bg-no-repeat">
            <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
        </div>
    </div>
</body>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, push, set, update, onChildAdded, remove, onChildRemoved, onChildChanged }
    from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db,"chat");

    $("#send").on("click", function(){
        const msg = {
            uname : $("#uname").val(),
            text : $("#text").val()
        }

        const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ç”Ÿæˆ
        set(newPostRef, msg);
    });

    //æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapshotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        onChildAdded(dbRef, function (data) {
            const msg = data.val();    //ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å¤‰æ•°msgã«ä»£å…¥
            const key = data.key;      //ãƒ‡ãƒ¼ã‚¿ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ï¼ˆå‰Šé™¤ã‚„æ›´æ–°ã«å¿…é ˆï¼ï¼‰
            //è¡¨ç¤ºç”¨ãƒ†ã‚­ã‚¹ãƒˆãƒ»HTMLã‚’ä½œæˆ
            let h = `
                <div class="odd:w-[200px] odd:bg-gray-200 odd:me-12 odd:justify-start even:w-[200px] even:bg-green-500 even:ms-12 even:justify-end flex flex-col p-2 rounded-lg" id=${key}>
                    <p class="font-bold">${msg.uname}</p>
                    <p><span contentEditable="true" id="${key}_update">${msg.text}</span></p>
                    <div class="flex space-x-2">
                        <span class="remove" data-key="${key}">ğŸš®</span>
                        <span class="update" data-key="${key}">ğŸ†™</span>
                    </div>
                </div>
            `
            $("#output").append(h); //#outputã®æœ€å¾Œã«è¿½åŠ 
        });

    //å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆ
    $("#output").on("click", ".remove", function(){
        const key = $(this).attr("data-key");
        const remove_item = ref(db, "chat/"+key);
        remove(remove_item); //Firebaseãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°
    });

    //å‰Šé™¤å‡¦ç†ãŒFirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
    onChildRemoved(dbRef, (data) =>{
        $("#"+data.key).remove(); //DOMæ“ä½œé–¢æ•°ï¼ˆå¯¾è±¡ã‚’å‰Šé™¤ï¼‰
    })

    //æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
    $("#output").on("click", ".update", function () {
            const key = $(this).attr("data-key");
            update(ref(db, "chat/"+key), {
                text : $("#"+key+'_update').html()
            });
        });

    //æ›´æ–°å‡¦ç†ãŒFirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
        onChildChanged(dbRef, (data) => {
            $("#" + data.key+'_update').html(data.val().text);
            $("#" + data.key + '_update').fadeOut(800).fadeIn(800);
        })

</script>
</body>
</html>
































